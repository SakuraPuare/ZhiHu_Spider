import json
import time

import httpx
import tqdm

from database import SQL, Article, User

article = ['/540290222', '/540278670', '/539990464', '/542592920', '/540334809', '/540236229', '/540515967',
           '/540371813', '/540228430', '/540534567', '/540160247', '/540178091', '/540259499', '/540357364',
           '/540441630', '/540066032', '/540272472', '/540165739', '/540392918', '/540092249', '/540344038',
           '/540490884', '/539967747', '/540293570', '/541453860', '/540084078', '/540719397', '/540310910',
           '/540159980', '/540156472', '/540419845', '/540158984', '/544527938', '/540548036', '/540331225',
           '/545289705', '/540233186', '/28852607', '/540484150', '/541253986', '/540261851', '/540986493',
           '/540259220', '/541743028', '/540504005', '/540348084', '/540017199', '/540279702', '/544356192',
           '/540483824', '/540253380', '/540463327', '/540228252', '/540922549', '/540268830', '/540616182',
           '/540507680', '/540334044', '/540520041', '/540256338', '/540358806', '/540518380', '/540247849',
           '/540107247', '/548561610', '/540380866', '/540291575', '/540342009', '/540323708', '/540275203',
           '/548322852', '/540221033', '/540293020', '/540296467', '/540687570', '/540748354', '/540094147',
           '/540727154', '/540314706', '/540236776', '/541524698', '/540183901', '/540150676', '/540272467',
           '/542269771', '/540268304', '/542249230', '/540155651', '/540138056', '/540057280', '/540177263',
           '/540389201', '/540922477', '/540192950', '/541111873', '/540295851', '/540012232', '/540373681',
           '/540330275', '/540428407', '/541399990', '/541459425', '/540015888', '/543504640', '/540115263',
           '/540211871', '/540323577', '/540323580', '/540040762', '/540276565', '/540044019', '/540320153']

url = 'https://www.zhihu.com/api/v4/articles'
sql = SQL()

with open('cookies.json', 'r') as f:
    httpx_cookies = httpx.Cookies()
    cookies = json.load(f)
    for cookie in cookies:
        httpx_cookies.set(cookie.get('name'), cookie.get('value'), domain=cookie.get('domain'))

for i in tqdm.tqdm(article):
    with httpx.Client(cookies=httpx_cookies, verify=False) as client:
        resp = client.get(url + i)
        data = resp.json()
        sql.insert_into('user', User, data.get('author'))
        sql.insert_into('article', Article, data)
        time.sleep(0.5)
